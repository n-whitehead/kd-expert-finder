<!doctype html>
<html>

<head>
    <title>Expert Finder</title>
    <script src="Chart.min.js"></script>
    <script src="jquery.js"></script>
    <style>
            canvas {
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
            }


    </style>
</head>

<body>
<textarea id="iris" cols="100" rows="3"></textarea>
<textarea id="decay" cols="100" rows="3"></textarea>
<textarea id="count" cols="100" rows="3"></textarea>
<button id="Retrieve">Retrieve</button>
<div id="authors" style="width: 100%;">
</div>
<div id="container" style="width: 100%;">
</div>
<script>
            $(document).ready(function () {
            });
            function createDataset(testData) {
                var selectedAuthors = testData.result;
                var authorsElem = document.getElementById("authors");
                var title = document.createElement("h3");
                title.innerHTML = "Recommended Experts";
                var list = document.createElement("ol");
                authorsElem.appendChild(title);
                authorsElem.appendChild(list);

                authors = []
                for (k = 0, len = selectedAuthors.length; k < len; k++) {
                    var item = document.createElement("li");
                    var author = selectedAuthors[k].id
                    authors.push(author);
                    hindexes = []
                    for (i = 0, len = selectedAuthors[k].concepts.length; i < len; i++) {
                        hindexObj = {
                                      label: selectedAuthors[k].concepts[i].prefLabels[0],
                                      data: selectedAuthors[k].concepts[i].hindex,
                                      backgroundColor: Utils.CHART_COLORS.red
                                    };
                        var conceptName = selectedAuthors[k].concepts[i].prefLabel[0];
                        var subjects = [];
                        var hindexes = [];
                        subjects.push(concept.concept);
                            hindexes.push(concept.hindex);


                        hindexObj.data = hindexes,
                        hindexes.push(hindexObj);
                        var chartcont = document.createElement("div");
                        chartcont.id = "chartcont" + i;
                        chartcont.style = 'width: 33%;float:left;';
                        var canvas = document.createElement("canvas");
                        canvas.id = "myChart" + i;
                        var ctx = canvas.getContext('2d');
                        chartcont.appendChild(canvas);
                        document.getElementById("container").appendChild(chartcont);
                        var myChart = createChart(ctx, author, conceptName, hindexes, selectedAuthors);
                    }
                }
            }

            function createChart(ctx, labels, authors, hindexes, selectedAuthors) {
                return new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: authors,
                        datasets: [{
                                label: labels,
                                data: hindexes,
                                backgroundColor: function (context) {
                                    var index = context.dataIndex;
                                    var value = context.chart.data.labels[index];
                                    var color = 'blue';
                                    for (k = 0, len = selectedAuthors.length; k < len; k++) {
                                        if (value === selectedAuthors[k].id) {
                                            color = 'green';
                                        }
                                    }
                                    return color;
                                },
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)'
                                ],
                                borderWidth: 1
                            }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                          legend: {
                            position: 'top',
                          },
                          title: {
                            display: true,
                            text: 'Chart.js Bar Chart'
                          }
                        }
                });
            }

            window.onload = function () {
                //			var ctx = document.getElementById('canvas').getContext('2d');
                //			window.myBar = new Chart(ctx, {
                //				type: 'bar',
                //				data: barChartData,
                //				options: {
                //
                //				}
                //			});
                //
            };

            document.getElementById('Retrieve').addEventListener('click', function () {
                var iriText = document.getElementById("iris").value;
                var iriText = iriText.split(",");
                var iris = "iri=" + iriText.join("&iri=");
                var data = iris;
                var decayVar = document.getElementById("decay");
                if (decayVar != undefined)  {
                    var decayText = decayVar.value;
                    var decay = "&decay="
                    var data = data + decay + decayText;
                }
                var countVar = document.getElementById("k");
                if (countVar != undefined)  {
                    var countText = countVar.value;
                    var count = "&count="
                    var data = data + count + countText;
                }
                $.ajax({
                    type: 'GET',
                    url: '/expert',
                    data: data,
                    success: function (d) {
                        document.getElementById("authors").innerHTML = "";
                        document.getElementById("container").innerHTML = "";
                        createDataset(d);
                    },
                    failure: function (d) {
                        console.error("some error occurred " + d);
                    }
                });
            });


</script>
</body>

</html>